```toc
```

## 9.1 보안의 개념과 정의
### 9.1.1 정보 보안의 정의
- 3대 보안 정의
	- 기밀성(Confidentiality)
		- 인가되지 않은 사용자가 정보를 보지 못하게 하는 작업
		- 암호화 작업
	- 무결성(Integrity)
		- 정확하고 안전한 정보 유지에 필요한 모든 작업
		- MD5, SHA 같은 해시 함수로 변경 여부 파악
	- 가용성(Availability)
		- 정보가 필요할 때 접근을 허락하는 일련의 작업
		- 유지하는 정보에 대해 사고날 염려 없이 온전한 상태를 유지하는 것이 정보 보안이므로 그 정보를 사용할 수 없는 상황이라면 정보 보안에 실패한 것

- 추가
	- 진정성(Authenticity)
	- 책임성(Accountability)
	- 부인 방지(Non-Repudiation)
	- 신뢰성(Reliability)


### 9.1.2 네트워크의 정보 보안
- 정보를 수집, 가공, 저장, 검색, 송수신하는 도중 정보 훼손, 변조, 유출을 막기 위한 관리적, 기술적 방법

- 정보 시스템이 공격 받아 정보 서비스가 정상적으로 운영되지 않는 것을 막는 게 1차 목표
- 네트워크를 통해 복제, 이동되는 정보 유출을 막는 게 2차 목표

- 네트워크 보안은 외부 공격에 맞서는 중요한 1차 방어선
- 시스템과 애플리케이션에 결함이 있어도 네트워크의 다양한 보안 장비를 활용한다면 외부의 공격을 늦추거나 적절히 방어할 수 있다.

### 9.1.3 네트워크 보안의 주요 개념
![](files/Pasted%20image%2020250420160633.png)
- 외부 네트워크로부터 내부 네트워크를 보호
- 이때 보호받아야 할 네트워크를 Trust 네트워크, 신뢰할 수 없는 외부 네트워크를 Untrust 네트워크로 구분한다.
- 한 단계 더 나아가 우리가 운영하는 네트워크이지만 신뢰할 수 없는 외부 사용자에게 개방해야 하는 서비스 네트워크인 경우 DMZ(DeMilitarized Zone) 네트워크라 부르며 일반적으로 인터넷에 공개되는 서비스를 이 네트워크에 배치한다.

- 트래픽 방향과 용도에 따라 두 가지로 구분
	- Internet Secure Gateway
		- 트러스트 또는 DMZ 네트워크에서 언트러스트 네트워크로의 통신을 통제
	- Data Center Secure Gateway
		- 언트러스트 네트워크에서 트러스트 또는 DMZ 네트워크로의 통신을 통제

- 이는 보안 장비 시장을 구분할 때도 사용
- 상황에 따라 요구되는 성능과 기능이 다름
- 인터넷으로 나갈 때는 인터넷에 수많은 서비스가 있으므로 그에 대한 정보와 요청 패킷을 적절히 인식하고, 필터링하는 기능이 필요
- 반면 데이터 센터 게이트웨이는 상대적으로 고성능이 필요하고, 외부의 직접적인 공격을 막아야하므로 인터넷 관련 정보보다 공격 관련 정보가 더 중요

- 전자의 경우 인터넷 시큐어 게이트웨이라고 함
- 방화벽, SWG(Secure Web Gateway), 웹 필터(Web Filter), 애플리케이션 컨트롤(Application Control), 샌드박스(Sandbox)와 같은 다양한 서비스나 네트워크 장비 포함
- 이는 내부 사용자가 인터넷으로 통신할 때 보안을 제공, 통제하기 위함

- 후자의 경우 데이터 센터 시큐어 게이트웨이라고 함
- 방화벽, IPS, DCSG(DataCenter Secure Gateway), WAF(Web Application Firewall), Anti-DDoS(Distribute Denial of Service)등의 장비가 이런 용도로 쓰인다.

#### 9.1.3.1 네트워크 보안 정책 수립에 따른 분류
- 두 가지로 분류  가능
	- 화이트리스트(White List)
	- 블랙리스트(Black List)

- 화이트 리스트는 방어에 문제가 없다고 명확히 판단되는 통신만 허용
- 일반적으로 IP, 통신 정보를 명확히 알 때 사용
- 내부 방화벽에서 많이 사용

- 블랙리스트 방어는 공격이 명확하거나 문제가 있었던 IP 리스트, 패킷 리스트를 기반으로 데이터베이스를 만들고 그 정보를 이용해 방어
- 각종 패턴으로 공격을 방어하는 네트워크 장비들은 블랙리스트 기반으로 동작
- 공격 당할 때 이를 분석해 공격 기법을 판단해 탐지하도록 간단히 적어 데이터베이스로 만든다
	- 이런 데이터베이스를 공격 패턴(Signature)라고 부른다

- 네트워크 보안 장비는 화이트리스트나 블랙리스트 기반 중 하나만 목표로 만들 때도 있다
- IPS, 안티바이러스처럼 악성 코드나 공격 기법에 대한 시그니처를 만들고 데이터베이스를 업데이트 받아 동작하는 장비가 블랙리스트 기반 장비

- 대부분의 장비는 수립 정책에 따라 화이트리스트, 블랙리스트 모두 사용 가능

- 보안 위협이 증가하면서 화이트리스트 기반 정책이 많이 사용된다
- 하지만 이를 사용하려면 통신 정보를 상세히 알아야 하고, 세부적인 통제가 필요하므로 많은 관리 인력 필요
- 관리 인력이 부족하다면 블랙리스트 기반 방어 정책을 수립하고, 공격 데이터베이스를 최신으로 유지

#### 9.1.3.2 정탐, 오탐, 미탐(탐지 에러 타입)
- IPS나 안티바이러스 같은 네트워크 장비에서는 공격 데이터베이스에 따라 공격, 악성 코드를 구분해 탐지
- 공격 데이터베이스를 아무리 정교히 만들어도 공격을 탐지하지 못하거나 공격이 아닌데도 공격으로 감지해 패킷을 드롭시키기도 함

![](files/Pasted%20image%2020250420161633.png)

- 최근 보안 벤더는 블랙리스트, 화이트리스트 적절히 섞어서 사용하는 것을 권고

### 9.1.4 네트워크 정보 보안의 발전 추세와 고려사항
- 보안 장비는 보안 영역 외부와 내부의 변화로 발전
- 외부는 인프라스트럭처나 서비스의 대변화로 보안이 따라서 발전하는 경우
- 내부는 해킹 기술의 발전에 대응하다보니 새로운 보안 장비와 서비스가 개발되어 발전하는 경우

- 네트워크나 서비스의 큰 변화는 보통 필요에 의한 변화이므로 보안이 고려되지 않는 경우가 많음
- 보안을 뒤늦게 고려하게 되며, 내부적인 변화가 아니라서 쉽게 대응이 어려움

- IT 산업 변화로 보안에 어려움을 겪으면서도 반대로 이를 수용해 보안 장비가 발전하기도 함
- 빅데이터, 머신러닝이 대표적인 예

## 9.2 보안 솔루션의 종류
![](files/Pasted%20image%2020250420162236.png)

- 새로운 형태의 장비가 출시되어도 기존 보안 장비가 필요없는 게 아니라 기존 보안 장비에 추가적으로 새로운 보안 솔루션을 줌
- 모든 공격을 한 대의 장비로 방어할 수 없으므로 여러 장비의 기능으로 단계적으로 방어
### 9.2.1 DDoS방어 장비
- DoS 공격은 다양한 방법으로 공격 목표에 서비스 부하를 가해 정상적인 서비스를 방해하는 공격
- DoS 공격은 공격 출발지에서 공격하는 것이 일반적이므로 비교적 탐지가 쉽고 짧은 시간 안에 이를 탐지만 할 수 있다면 IP 주소 기반으로 충분히 방어 가능
- 이를 회피하고 더 짧은 시간 안에 공격 성과를 내기 위해 다수의 봇을 이용해 분산 공격을 수행하는 DDoS 공격 기법이 등장

- DDoS 장비는 DDoS 공격을 방어하는 장비
- 데이터센터 네트워크 내부와 외부의 경계에서 공격을 방어
- 이는 Volumetric Attack을 우선 막기 위해서
	- 회선 사용량 이상의 트래픽을 발생시켜 회선 사용을 방해하는 공격
	- ISP와 연결되는 데이터 센터 네트워크 가장 바깥쪽에 위치해 공격을 완화해야 함

### 9.2.2 방화벽
- 4계층에서 동작하는 패킷 필터링
- 3, 4계층 정보 기반으로 정책 세움
- 해당 정책과 매치되는 패킷이 방화벽을 통과하면 그 패킷을 허용하거나 거부

- 일반적으로 DDoS 방어 장비 바로 뒤에 놓는다
- 3, 4계층에서 동작하므로 다른 보안 장비보다 비교적 간단히 동작하고 성능도 우수
- 최근 출시되는 고성능 방화벽은 ASIC나 FPGA와 같은 전용 칩을 이용해 가속

### 9.2.3 IDS, IPS
- IDS(Intrusion Detection System: 침입 탐지 시스템), IPS(Intrusion Prevention System : 침입 방지 시스템)는 방화벽에서 방어할 수 없는 다양한 애플리케이션 공격을 방어
- 최근은 IPS로 통칭한다.

- 사전에 공격 데이터베이스를 제조사나 위협 인텔리전스 서비스 업체로부터 받아
- 인입된 패킷이 해당하는 공격이라면 차단하거나 모니터링한 후 관리자에게 알람 보낸다

- 기존에는 공격만 방어하는 블랙리스트 방식만 제공되었지만
- 최근에는 프로파일링 기반의 방어 기법이 IPS 장비에 적용, 애플리케이션을 골라 방어할 수 있는 애플리케이션 컨트롤 기능이 추가되어 화이트리스트 기반의 방어 기법도 적용 가능

### 9.2.4 WAF
- Web Application Firewall
- 웹서버를 보호하는 전용 보안 장비
- HTTP, HTTPS처럼 웹 서버에서 동작하는 웹 프로토콜의 공격을 방어
- IDS, IDP 장비보다 범용성이 떨어지지만 웹 프로토콜에 대해서는 더 세밀히 방어

- WAF는 다양한 형태의 장비나 소프트웨어로 제공
	- 전용 네트워크 장비
	- 웹 서버 플러그인
	- ADC 플러그인
	- 프록시 장비 플러그인

- IPS에서 방어할 수 없는 IPS 회피 공격(Evasion Attack)을 방어할 수 있다
- IPS는 데이터를 조합하지 않고 처리하지만 WAF는 프록시 서버와 같이 패킷을 데이터 형태로 조합해 처리
- 회피 공격을 쉽게 만들기 어렵고 데이터의 일부를 수정, 추가 기능 수행 가능
- 방어만 하지 않고 공격자에게 통보하거나 민감한 데이터가 유출될 때 그 정보만 제거해서 보내주기 등

### 9.2.5 샌드박스
- 기존에는 해커가 직접 공격을 수행
- 자신을 숨기기 위해 경유지를 통한 공격 외에는 직접 공격하는 게 가장 쉬웠음
- 이런 공격을 방어할 수단도 많지 않았고, 전문적인 보안 장비도 많이 없었기 때문
- 그러나 지금은 보안이 발전하면서 직접 공격하는 게 어려워짐
- 따라서 다른 방법을 찾기 시작

- 우회 기법도 많이 늘었지만, 근본적으로 공격 방법이 바뀜
- 관리자 PC에 악성 코드를 심고 이 PC를 컨트롤
	- 이메일, 피싱 등등
- 외부에서 컨트롤하도록 C&C(Command & Control) 서버를 만들고 감염 PC가 C&C 서버로 연결되도록 조작
- 기존 방화벽은 내부 -> 외부 연결이므로 잡을 수 없었음

- 이런 공격은 발전해 APT(Advanced Persistent Thread), ATA(Advanced Target Attack)이 됨
- 이를 막기위해 IPS 장비와 C&C 서버와의 통신을 탐지할 수 있는 다양한 형태의 Anti-APT 솔루션 개발됨

- 샌드박스는 APT의 공격을 방어하는 대표적인 장비
- 악성 코드를 샌드박스 시스템에서 직접 실행
- 가상 운영체제 안에서 각종 파일을 직접 실행, 행동을 모니터링해 악성 코드 여부를 판별
- 기존 보안 장비와 보안 솔루션을 피하는 회피 공격을 탐지하고 기존 보안 솔루션을 보완

- 최근 악성 코드는 다크웹에서 코드가 공개되거나 사고 팔림 -> 재사용 많음
- 짧은 기간 안에 다양한 변종이 출현해 탐지가 어렵고, 기존 보안 시스템이 탐지하지 못하도록 암호화, 난독화하거나 매우 오랫동안 여러 단계에 걸쳐 공격

- 파일을 직접 실행 후 모니터링하면 악성 코드를 감싼 많은 트릭을 제거하거나 탐지할 수 있다

### 9.2.6 NAC
- NAC(Network Access Control)은 네트워크에 접속하는 장치들을 제어하기 위해서 만들어짐
- 인가된 사용자마 내부망 접속 가능, 인가받기 전이나 승인에 실패한 사용자는 접속할 수 없도록 제어

- 내부 PC를 아무리 잘 관리해도 외부 PC가 내부망에 접속해 보안사고를 일으키거나 악성 코드를 전파하는 문제점들이 많아서 개발됨

### 9.2.7 IP제어
- 국내에서 많이 사용됨. NAC와 다른 목적
- 보안 사고 추적이 쉽도록 고정 IP 사용 권고 지침이 금융권에 내려오면서 IP를 할당하고 추적하는 솔루션이 필요해짐
- 할당된 IP 관리, 정확히 의도된 IP 할당이 아니면 네트워크 사용 막기
### 9.2.8 접근 통제
![](files/Pasted%20image%2020250422211709.png)
- 직접 DB, 서버, 장비 접근하면 권한 관리도 어렵고 추적도 어려움
- 직접 접근을 막고 작업 추적 및 감사를 할 수 있는 접근 통제 솔루션이 개발됨
- 에이전트 기반, 에이전트리스 등 구현 방법에 따라 나뉨
- 대부분 Bastion Host로 구현됨

> 최근에 진수님이 https://goteleport.com/ 각을 봐보고 계십니다.

- 서버 접근을 위한 모든 통신은 배스천 통해서
- 방화벽에서 배스천 호스트에서 출발한 통신만 허용
- 배스천 호스트의 보안, 감사를 높이면 보안 강화 가능
- 이를 발전시킨 게 현재의 접근 통제/감사 솔루션

- 접근 제어뿐만 아니라 감사, 보안 이슈 대응을 위해 사용자가 작업한 모든 이력을 저장

### 9.2.9 VPN
![](files/Pasted%20image%2020250422211817.png)
- 사용자 기반의 VPN 서비스 제공해주는 장비
- 기존에는 별도 서비스 하드웨어가 있었지만 요즘은 방화벽이나 라우터 장비에 포함됨

- 가장 많이 사용하는 건 IPSEC, SSL
- IPSEC은 네트워크 연결, SSLVPN은 사용자가 내부 네트워크 연결할 때 주로 쓰임

## 9.3 방화벽
- 네트워크 보안은 호스트 보안과 달리 많은 호스트를 한 번에 관리 가능 -> 대신 많은 트래픽 견뎌야 함. 속도 저하 없어야 함
- 가장 유명하고 대중적인 장비는 방화벽

### 9.3.1 방화벽의 정의
- 사전에 주어진 정책 조건에 맞추어 트래픽을 허용하거나 차단
- 일반적으로 방화벽은 3, 4계층에서 동작하며 세션을 인지하는 상태 기반 엔진(Stateful Packet Inspection, SPI)으로 동작
### 9.3.2 초기 방화벽
- SPI 엔진이 처음부터 있지는 않았음
- 초기에는 패킷의 인과 관계를 인지하지 못했고, 장비에 등록된 정책만으로 단순히 필터링
- 이를 Stateless, Packet Filter 방화벽이라고 함

![](files/Pasted%20image%2020250422212114.png)

- 패킷이 오면 정책과 비교 -> 차단, 허용
- 이때 참고하는 조건을 5-Tuple이라고 함
	- Source IP, Destination IP, Protocol No, Source Port, Destination Port

- 간단한 건 괜찮지만 인터넷 통신처럼 불특정 다수 기반의 정책을 정의할 때는 룰셋이 복잡해지고 보안이 약화됨
- 패킷 단위의 필터링이므로 5-튜플 이외의 3, 4계층 헤더를 변조해 공격하면 적절한 방어가 불가능

- 패킷 필터링 자체는 다른 세대 방화벽보다 부하가 적고 간단해 쓰이는 경우도 있음
- 지정된 IP 방어하는 데는 간단한 패킷 필터링이 부하가 적어 블랙리스트 처리를 위해 방화벽 내부에 패킷 필터링 엔진과 SPI 엔진을 함께 동작시키기도 함.

### 9.3.3 현대적 방화벽의 등장 (SPI 엔진)
- 우리가 부르는 방화벽은 모두 세션 기반의 SPI 엔진 탑재

- 패킷 필터는 가볍고 빠르지만 인터넷 환경에서는 정책 관리가 어려움
- 통신은 대부분 양방향인데, 패킷 필터 엔진은 이런 양방향성을 인지하지 못하고 단순히 패킷이 조건과 일치하는지만 검사

![](files/Pasted%20image%2020250422212319.png)

- 3-way handshake 후 HTTP 요청 및 응답같은 트래픽을 처리하기 위해서는 목적지가 불특정 다수이므로 외부로 나가는 모든 패킷을 허용해야 함
- 이렇게 설정하면 내부 -> 외부는 괜찮지만, 외부 -> 내부 응답에 대한 정책이 없어 정상적인 통신이 불가능
- 응답에 대한 정책을 설정하면 출발지는 모든 IP, 목적지 서비스 포트는 내부에서 외부 호출 시 랜덤 포트이므로 사실상 모든 포트
- 즉, 매우 보안에 취약
- -> 패킷 상태를 인지해 패킷의 인과관계를 파악

![](files/Pasted%20image%2020250422212553.png)

- SPI는 내부에서 외부 통신으로 받은 응답과 외부에서 내부로 직접 들어오려는 패킷을 구분 가능

### 9.3.4 방화벽 동작 방식
-  최근 방화벽은 보안 강화, 성능 높이기 위해 여러 개의 엔진과 다양한 기능을 가져 동작 방식이나 패킷 처리 순서는 다를 수 있음

![](files/Pasted%20image%2020250422212713.png)

1. 장비에 패킷이 들어오면 우선 세션 상태 테이블을 확인합니다.
2. 조건에 맞는 세션 정보가 세션 테이블에 있을 때, 포워딩 테이블을 확인합니다(라우팅, ARP 포함).
3. 조건에 맞는 세션 정보가 세션 테이블에 없을 때, 방화벽 정책을 확인합니다.
4. 방화벽 정책은 맨 위의 정책부터 확인해 최종 정책까지 확인한 후 없을 때 암시적인 거부(Implicit Denial) 규칙을 참고해 차단됩니다.
5. 허용 규칙이 있으면 내용을 세션 테이블에 적어 넣습니다.
6. 포워딩 테이블을 확인합니다(라우팅, ARP 포함).
7. 조건에 맞는 정보가 포워딩 테이블에 있을 때, 적절한 인터페이스로 패킷을 포워딩합니다.
8. 조건에 맞는 정보가 포워딩 테이블에 없을 때, 패킷을 폐기합니다.

- SPI 엔진은 세션 인지 기능이 있어 5-튜플만 보는 게 아니라 OSI 3, 4계층 세부 필드도 확인
- TCP 컨트롤 플래그에 따른 동작 방식 변화, 시퀀스와 ACK 번호 변경 등을 인지하고 세션 탈취 공격을 일부 방어할 수 있음
	- -> TCP Anti-Replay
	- Replay Attack : 데이터 복사해놓고, 다시 재전송하는 공격 기법
	- TCP Anti-Replay : TCP에서 이를 막는 기법
		- Seq, Ack 등이 너무 오래되었거나 이미 받은 거라면 무시함

- 세션 테이블이 있어 세션 로깅이 쉬움
- 대부분의 방화벽은 통신 전체 세션을 로그로 저장 가능

### 9.3.5 ALG
- 방화벽은 패킷 필터 엔진보다 헤더 저보를 상세히 확인하고, 세션을 인지하지만 애플리케이션 헤더 정보는 알 수 없음
- 세션 방화벽 이전에 개발된 고대 프로토콜은 방화벽 같은 세션 장비를 고려하지 못해 방화벽이 있으면 통신이 안 되기도 함 -> FTP

![](files/Pasted%20image%2020250422213040.png)

- FTP Active Mode에서는 초기 접속 방향과 반대로 데이터 프로토콜이 동작해 방화벽 통과 불가능

![](files/Pasted%20image%2020250422213104.png)

- FTP 패시브 모드로 변경하면 됨
- 근데 패시브 모드 못 쓸 수도 있고, 변경 못 할 수도 있음
- 그래서 방화벽에서 FTP 액티브 모드 통과를 위해 애플리케이션 프로토콜 확인하고 필요에 따라 세션을 인지해 포트를 자동으로 열어줌
- 이를 ALG(Application Layer Gateway) 기능이라고 함
- 일반적으로 PAT 기능이 동작하는 방화벽에서 PAT를 정상적으로 통과하지 못하는 프로토콜을 자동으로 인지해 애플리케이션 정보를 바꿔주거나 세션 테이블을 만들어줌
- FTP ALG 기능이 동작하려면 패킷이 방화벽을 지나갈 때 방화벽이나 해당 패킷이 참조하는 정책에 ALG 기능이 켜져있어야 함

1. FTP ALG 기능은 초기 FTP 요청 커맨드를 모니터링합니다.
2. 서버 쪽에서 사용할 데이터 세션에서 사용할 포트를 클라이언트로 알려줄 때, 이 정보를 확인하고 적절한 세션 정보를 만듭니다. 서버의 출발지 IP와 포트는 TCP 20번으로, 클라이언트의 IP와 서버에서 알려준 포트를 도착지로 하는 세션을 만들어 세션 테이블에 올립니다.
3. 서버에서 클라이언트로 데이터 세션을 열 때, 세션 테이블에 이미 정보가 들어가 있어 정책을 확인하지 않고 패킷이 포워딩됩니다.

- 다양한 ALG 기능이 있지만, 모든 프로토콜을 지원하지 않으므로 완벽한 해결책은 아님
- 요즘은 다 방화벽, NAT 고려해서 개발되고 있고, STUN, Hole Puching 기능 등이 있어 오래된 프로토콜 제외하고 잘 안 씀

### 9.3.6 방화벽의 한계
- 방화벽으로 기존 공격이 어려워지자 다양한 공격 방식이 새로 생김
- 계정 탈취에서 서비스 중단, DDoS 공격이 트렌드가 됨
- 방화벽 우회 공격이 개발되고, 대규모 웜 공격으로 인터넷 서비스 마비 등으로 방화벽 한계가 드러남
- SPI 방화벽은 적은 리소스로 다양한 공격을 쉽게 막을 수 있어 필수 요소가 되었지만 3,4 계층에서만 동작해 많은 한계가 있었음
	- 근본적으로 바이러스를 감지하거나 백도어, 인터넷 웜을 방어할 수는 없음
	- 알려진 취약적을 악용한 공격도 방어할 수 없음
	- 방화벽은 애플리케이션 영역을 검사하지 않음

- 이런 웜 공격을 막기위해 등장한 것이 IPS
- 이 외에도 여러 장비 개발됨

- 현대 방화벽 NGFW, UTM
	- 상태 기반 방화벽은 레거시 방화벽이라 불림
	- 기존 방화벽과 달리 네트워크 보안 장비의 대부분의 기능을 흡수해 통합, APT 공격에 대응하는 샌드박스 기능이 연계뙤어 제공됨
	- NGFW(Next Generation Firewall), UTM(Unified Thread Management Firewall)은 방화벽을 애플리케이션 영역까지 확장한 장비
	- 단, 내부 구현 방법이 다름
	- NGFW는 다양한 보안 장비의 기능이 논리적으로 통합됨
	- UTM은 물리적으로 여러 가지 엔진을 통합해 함께 동작

- NFV
	- 네트워크 컴포넌트를 가상화 많이 함
	- NFV(Network Function Virtualization)
	- 가상화 형태로 라우터, 방화벽, L4 스위치 등 탑재
	- ASIC보다 성능은 떨어지지만 서비스 체이닝으로 새로운 서비스 추가 및 삭제가 쉽고
	- DPDK, SR-IOV와 같은 I/O 가속 기술로 대형 사업자 중심으로 실제 환경에 적용되고 있지만 전용 장비에 비하면 성능이나 기능에 아쉬움이 있음
		- DPDK (Data Plane Development Kit)
			- https://giljae.medium.com/dpdk-data-plane-development-kit-%EB%9E%80-6c1d94da2d4c
			- 운영체제를 거치지 않고 네트워크 패킷을 직접 빠르게 처리하기
				1. CPU 처리 속도와 메모리/PCI 인터페이스 사이에서 발생하는 처리속도의 차이로 인한 문제를 DPDK에서는 다수 패킷을 동시에 처리하는 I/O 최적화 기술인 배치 패킷처리 기술을 사용하여 해결하였다.  
				2. 네트워크 패킷마다 동적으로 패킷을 위해 버퍼 메모리를 할당/해제하던 문제를 DPDK에서는 네트워크 패킷에 대해 고정 길이의 메모리를 사전 할당함으로써 문제를 해결하였다.  
				3. 공유 데이터 구조에 대한 접근으로 인한 병목현상이 일어날 때 패킷 처리 성능이 저하되는 문제점을 DPDK에서는 불필요한 대기시간이 발생하지 않도록 안전한 Lockless Queue를 구현하여 해결하였다.  
				4. 리눅스의 Page table size(4Kbyte)로 인해 TLB miss가 발생하는 문제점을 DPDK에서는 2MB 또는 1GB의 huge page를 사용하여 해결하였다.  
				5. 인터럽트 기반의 최적화되지 않은 물리 NIC와 가상 NIC 드라이버로 인한 성능 저하 문제를 DPDK에서는 최적화된 poll mode driver를 이용하여 해결하였다.  
				6. CPU가 데이터를 기다리는 상황으로 인한 패킷 처리 성능 저하 문제를 DPDK에서는 메모리 엑세스에 대한 Pre-fetching 기술 및 cache line 사이즈(64 Kbyte)로정렬하여 해결하였다.  
				7. 멀티 프로세서를 사용하더라도 성능이 스케일되지 않는 문제를 DPDK에서는 run-to-complete 모델을 통해 horizontal scalability를 제공한다.  
				8. 리눅스 스케줄러의 쓰레드 스위칭 오버헤드 문제를 DPDK에서는 소프트웨어 스레드를 하드웨어 스레드로 매핑하는 CPU Core Isolation 기술을 사용하여 해결하였다.  
				9. 호스트 커널 네트워킹 스택의 성능이 제약되는 문제점을 DPDK에서는 KNI(Kernel Network Interface)를 통해 커널 네트워킹 스택 성능을 개선하였다.  
		- SR-IOV (Single Root I/O Virtualization):
			- 실제 물리적인 랜카드 하나를 여러 개의 '가상 랜카드'로 쪼개서, 각각의 가상 컴퓨터(VM)가 마치 자기 전용 랜카드를 가진 것처럼 직접 사용

## 9.4 IPS, IDS
- 방화벽은 애플리케이션 계층 공격 방어 불가능
- 보통 서비스를 제공하는 시스템 자체의 취약점 이용
- 이를 탐지하고 방어하기 위해 IDS, IPS 개발됨

![](files/Pasted%20image%2020250427165343.png)

### 9.4.1 IPS, IDS의 정의
![](files/Pasted%20image%2020250427165503.png) 

- IDS(Intrusion Detection System)
- 공격자가 시스템 해킹할 때 탐지를 목적
- 즉, 방어보다는 탐지에 초점
	- 공격에 직접 개입하거나 방어하는 게 아니라 트래픽을 복제해 검토하고 침입 여부를 판단

![](files/Pasted%20image%2020250427165847.png)

- IPS(Intrusion Prevention System)
- 공격이 발견되면 즉시 차단
- 트래픽 복제해 검토만하는 것이 아니라 트래픽이 지나가는 인라인 상에 장비를 배치

- IPS, IDS는 통신 개입 여부 외에도 회피 공격을 차단하기 위한 세션 이해 가능 여부, 능동적 방어를 위한 Anomaly 등 다양한 기능으로 구분
- 최근 도입된 솔루션은 대부분 IPS

- IPS는 호스트 기반 IPS와 네트워크 기반 IPS
- 보안 트렌드나 시대적 요구사항에 따라 달라짐
	- 엔드포인트 보안이 강조될 때는 호스트 기반 IPS 솔루션이 많이 소개되고, 네트워크 보안이 강조될 때는 네트워크 IPS 장비들이 더 많아짐

- 일반적으로 IPS라 부르는 시스템은 네트워크 기반 NIPS(Network based IPS)
- 클라우드 네트워크는 제약사항 때문에 클라우드 내부에 NIPS 배포가 어려워 HIPS(Host based IPS) 빈도가 늘었지만 여러 가지 불편한 점때문에 클라우드 내부에서도 NIPS로 바뀌는 추세
	- 서비스와 리소스 공유, 장애 발생 시 장애 주체 파악 어려움 등

> 아마 초기에는 사용자가 클라우드 인프라를 관리하거나 제어하기 어려움이 있으니 Host 기반을 많이 했는데 클라우드 내에서도 GWLB, 트래픽 미러링 등 여러 기능을 지원하기 시작하면서 NIPS를 다시 활용하기 시작?

### 9.4.2 IPS, IDS의 동작 방식
- IPS는 공격 데이터베이스를 사용한 패턴 매칭 방식으로 운영되지만 프로토콜 어노말리, 프로파일 어노말리 등 다른 기법으로 공격 방어

#### 9.4.2.1 패턴 매칭 방식
![](files/Pasted%20image%2020250427171030.png)


- 기존 공격이나 취약점을 통한 공격 방식에 대한 데이터베이스를 습득하고, 이를 바탕으로 패턴 방식, 시그니처 방식, 데이터베이스 방식 방어라고 한다.
- 이런 패턴 기반 방어가 IPS 기능의 상당 부분 차지 -> 많은 공격 데이터베이스 보유가 중요

#### 9.4.2.2 어노말리 공격 방어
- 패턴 기반 매칭 방어가 유효하려면 공격 전에 데이터베이스가 있어야 함
- 패턴 기반 방어는 극미한 변화만 생겨도 적절한 대응이 어려웠고, 빠르게 전파되는 변종을 적절한 타이밍에 막아내기 어려웠다.
	- 웜 공격 변종은 4시간 만에 인터넷에 퍼지곤 했었음.

- 어노말리 기법은 분명한 공격으로 파악되지 않아도 특정 기준 이상의 행위를 이상하다고 판단하고 방어
- 이는 프로파일 어노말리(Profile Anomaly), 프로토콜 어노말리(Protocol Anomaly)로 나뉜다.

- 프로파일 어노말리
![](files/Pasted%20image%2020250427171401.png)

- 평소 정해둔 기준이나 IPS 장비가 모니터링해 정해진 기준과 다른 행위가 일어나면 공격으로 판단
- 프린트 서버에 FTP 패킷이 전송되는 경우, 평소 1MB 이하 트래픽이 발생하던 시스템에서 갑자기 수십 MB 이상의 트래픽이 발생하는 등 평소와 다른 행위에 초점을 맞춘다
	- 웜이 감염되면 다른 타깃으로 다량의 트래픽 발생시켜 감염시키는 행위 반복하므로 방어에 효과적이었다
- 동적 프로파일 기능이 강화되면서 향후 DDoS 방어 장비로 진화

- 프로토콜 어노말리

![](files/Pasted%20image%2020250427171659.png)

- SPI 방화벽, NAT 기능이 대중화되면서 해커가 일반 PC를 쉽게 공격할 수 없게 됨
- 방화벽을 우회해 공격하려면 웹 서버나 이메일에 악성 코드를 올려놓고 내부 사용자가 이를 실행하도록 유도함
- 악성 코드는 외부 C&C 서버와 연결되고, 이를 통해 사용자 정보를 전달하고 해커의 지시에 따라 행동
	- -> 좀비 PC
- 좀비 PC가 정상적으로 서비스 요청하는 것처럼 동작해 일반 방화벽에서는 이를 탐지 및 방어 불가능

![](files/Pasted%20image%2020250427171705.png)

- IPS 프로토콜 어노말리가 방어 가능
- 감염된 내부 PC와 와부 공격을 위한 통신을 할 때는 잘 알려진 서비스 포트를 사용
	- 그런데 잘 알려진 프로토콜 대신 다른 프로토콜 쓰는 경우가 흔함
- 이를 탐지하고 잘 제어하는 기법을 프로토콜 어노말리라고 함

### 9.4.3 IPS, IDS의 한계와 극복 (NGIPS)
- IPS에는 근본적인 문제가 있음
- 네트워크 상에서 빠른 속도로 애플리케이션 레벨을 확인하기 위해서는 Flow 엔진을 사용
- 패킷을 모아 데이터 형태로 변환해 검사하는 게 아니라 패킷이 흘러가는 상황을 모니터링해 공격을 탐지 -> IPS 장비를 비교적 쉽게 우회 가능

- IPS는 오탐이 많아 튜닝 필요하고, 별도의 관제 인력 필요
- 너무 많은 오탐과 알람 때문에 공격 방어를 못 하거나, 정상적인 서비스가 차단될 수도 있음
- 이런 문제를 해결하기 위해 예외처리 하다 보니 IPS 설치만 하고 제대로 사용하지 못하는 경우도 많음

- 기존 IPS 기능을 향상해 문제점을 해결한 NGIPS(Next Generation IPS) 개념의 장비가 출시됨
- 애플리케이션을 인지하거나 다양한 시스템과 연동할 수 있고, 특히 APT 공격을 방어하기 위한 일부 기능이 탑재되거나 다양한 외부 시스템을 연동할 수 있는 장비가 많이 나옴

- 방화벽이 NGFW, UTM으로 발전한 것처럼 IPS도 다양한 장비가 통합되는 추세

- IPS가 공격 데이터베이스를 얻는 법
	- 실제 해킹에 사용된 흔적을 이용해서 많이 작성함
	- 이를 위해 인터넷에 허니팟(honeypot) 시스템을 구축함
	- 공격에 대한 방어가 없고 취약점이 많은 허니팟을 해커는 공격 대상으로 생각하고 공격
	- 허니팟 시스템은 이를 로깅하고, 해킹 후 공격 기법을 분석해 데이터베이스로 바꿈

## 9.5 DDoS 방어 장비
- 기존 공격은 직접 공격해 관리자 권한 탈취 초점
- 방화벽 대중화 이후 정상적인 서비스가 불가능하도록 방해하는 데 초점이 맞춰짐

![](files/Pasted%20image%2020250427173337.png)

- 이를 DoS(Denial of Service) 공격
- 단, 해커 단독으로는 제한이 많으므로 다수의 공격자를 만들어 동시에 DoS 공격을 하는 DDoS 공격 방식으로 발전, 전용 장비 등장

### 9.5.1 DDoS방어 장비의 정의
- 초기 DDoS 공격은 시스템이나 네트워크 장비 취약점을 타깃
- 기존 장비를 보완, 취약점 패치 대응 등이 이루어지니 다양한 DDoS 공격 형태 등장
- 이를 방어하기 위해 DDoS 전용 방어 장비 등장
- 볼류메트릭 공격을 방어하기 위해 트래픽 프로파일링 기법을 주로 사용, 데이터베이스도 활용하기도 함
### 9.5.2 DDoS방어 장비 동작 방식
![](files/Pasted%20image%2020250427173701.png)

- 클라우드 서비스, 회선 사업자의 방어 서비스, DDoS 방어 장비를 사내에 설치 등
- 회선 사업자와 DDoS 방어 장비를 이원화해 협조하는 서비스도 많이 등장
- DDoS는 대규모 공격이므로 탐지 장비와 방어 장비를 구분하는 경우가 많았음 
- 공격을 탐지해 공격을 수행하는 IP 리스트를 넘겨주면 방어 장비나 IPS 내부에서 이 IP를 버리는 게 흔한 방어 기법

- DDoS 여부 판별 방식은 다양함
- 프로파일링
	- 평소 데이터 흐름을 습득해 일반적인 대역폭, 세션량, 초기 접속량, 프로토콜별 사용량 등을 저장 
	- 일치하지 않는 과도한 트래픽이 오면 알려주고 차단
- 데이터베이스
	- IP 평판 데이터베이스를 공유해 DDoS 공격으로 사용된 IP 기반으로 방어 여부를 결정하거나 특정 공격 패턴을 방어

### 9.5.3 DDoS공격 타입
![](files/Pasted%20image%2020250427173858.png)

- DDoS 방어 장비는 자동 프로파일링 기법을 지원, 사전에 정의된 데이터베이스로 애플리케이션 공격 방어도 가능하지만
- 볼류메트릭, 프로토콜 공격 방어가 주요 목표

### 9.5.4 볼류메트릭 공격
- 회선 사용량이나 그 이상의 트래픽을 과도하게 발생시켜 회선을 사용하지 못하도록 방해하는 공격
- ISP 내부나 사용자 네트워크 최상단에 위치시켜 이 공격을 완화해야 함
- DDoS 장비는 주로 볼류메트릭 공격이나 프로토콜 공격을 방어하는 데 사용
- 혼자 방어할 수 없는 공격도 많아 회선을 공급하는 ISP와 공조해 방어할 필요가 있다.

#### 9.5.4.1 좀비 PC를 이용한 볼류메트릭 공격
- 특정 시간에 특정 타깃을 공격
- 좀비 PC가 많이 필요
![](files/Pasted%20image%2020250427181426.png)

- 더 강력한 DDoS 공격을 위한 증폭 공격(Amplification Attack) 증가
- 수백 Gbps부터 1Tbps 이상에 이르는 엄청나게 높은 대역폭의 공격은 대부분 증폭 공격으로 이루어짐

![](files/Pasted%20image%2020250427181508.png)

- 공격자가 상대적으로 적은 대역폭으로 중간 리플렉터에 패킷을 보내면 이 트래픽이 증폭되어 수십 ~ 수백 배의 공격 트래픽이 발생
- 대부분 혼자서 방어가 불가능하므로 IPS를 통한 방어나 Cloud DDoS 솔루션을 통해 서비스 네트워크로 트래픽이 직접 도달하지 못하도록 조치해야 함

![](files/Pasted%20image%2020250427181518.png)

![](files/Pasted%20image%2020250427181911.png)

- 클라우드 기반은 별도 보안 장비 없어도 다양한 DDoS 공격을 방어할 수 있다는 장점이 있음
- 실제 서비스 앞에서 미리 클라이언트 요청을 받아서 문제가 없는 요청만 서버로 전달
- 실제 서비스 네트워크가 가려지므로 네트워크 차원이나 대규모 볼류메트릭 공격도 큰 투자 없이 방어 가능

## 9.6 VPN
- Virtual Private Network
- 물리적으로 전용선이 아닌 공중망을 이용해 논리적으로 직접 연결한 것처럼 망을 구성하는 기술
- 논리적으로 직접 연결된 것처럼 만들어주는 통로를 터널이라고 하며, VPN을 이용하면 터널을 이용해 직접 연결한 것처럼 동작

- 터널링 기법만 제공할 수 있다면 VPN이라고 할 수 있지만, 터널링만 제공하는 기법은 자주 사용되지 않음
- 공중망을 전용선과 같은 사설망처럼 사용하기 위해 도입하므로 강력한 보안 제공 필요
- IPSEC, SSL 등 암호화 기법을 제공하는 프로토콜이 VPN에 주로 사용됨

![](files/Pasted%20image%2020250427183036.png)

- PPTP, L2TP, GRE 등 암호화를 지원하지 않거나 매우 간단한 암호화만 지원하는 기술이 쓰였지만
- 최근에는 이런 기술을 사용하더라도 IPSEC의 보안 기술이 추가적으로 함께 사용됨

- 본사, 지사 네트워크처럼 대 네트워크 연결에는 IPSEC VPN 기술이 주로 사용되고, 개인 사용자가 본사 네트워크로 접속하는 경우 SSLVPN 기술이 사용됨

![](files/Pasted%20image%2020250427183146.png)

- 네트워크 간 연결은 보안이 강력한 IPSEC 기반 VPN 사용
- 이때 VPN이 연결되는 본사와 지사 모두 IPSEC VPN을 지원하는 네트워크 장비 필요

![](files/Pasted%20image%2020250427183150.png)

- SSLVPN 기술은 PC 대 네트워크, 모바일 단말 대 네트워크 접속에 사용
- 별도 네트워크 장비 없이 VPN 연결 사용 가능

### 9.6.1 VPN 동작 방식
![](files/Pasted%20image%2020250427183248.png)

- VPN은 가상 네트워크를 만들어주는 장비로 터널링 기법을 사용
- 패킷을 터널링 프로토콜로 감사서 통신하는 기법이 터널링 기법
- VPN 프로토콜은 보안을 위해 다양한 기술이 포함되어있음
	- 패킷 암호화, 인증, 무결성 체크 등
	- 인터넷에 패킷이 노출되어도 해커나 기관이 감청하지 못하도록 보호
- IPSEC, SSL 보안 프로토콜을 많이 사용

- 3가지 형태
	- Host to Host 통신 보호
	- Network to Network 통신 보호
	- Host가 Network 접근할 때 보호

![](files/Pasted%20image%2020250427183621.png)

- Host to Host 통신
	- 두 호스트 간 직접 VPN 터널 연동
	- 잘 사용하지는 않음
	- 일반적인 VPN 장비는 Network to Network, Host to Network 통신 보호 기능 제공

![](files/Pasted%20image%2020250427183715.png)

- Network to Network 통신
	- 본사-지사 같은 특정 네트워크를 연결
	- IPSEC 많이 사용

![](files/Pasted%20image%2020250427183745.png)

- Host to Network
	- 모바일 사용자가 일반 인터넷망을 통해 사내망 연결
	- IPSEC, SSL 범용적으로 사용

- 사이트 우회, 특정 국가 직구 등을 위해 다양한 VPN 서비스 사용됨
- 카페와 같은 공중 무선망 사용할 때 해커 공격을 방어할 수 있어 쓰면 보안에 좋긴 하다

- 회피 공격
	- 공격자가 시도한 공격이 보안 장비에서는 정상 통신으로 보이지만, 실제로 그 공격이 피해자에게 도착하면 공격으로 동작하는 모든 공격을 회피 공겨이라고 함
	- 회피 공격은 피해자가 패킷과 데이터를 처리하는 방법과 보안 장비가 처리하는 방법이 다른 걸 이용
		- 보안 장비는 네트워크 중간에서 공격 여부 판단
		- 즉, 피해자와 동일한 환경에서 패킷 점검이 불가능
		- 보통 IPS를 우회
	- ATTACK 탐지를 우회하려면 한 번에 들어가지 않도록 쪼개고 순서를 바꿔서 보냄
	- 이렇게 하면 중간 IPS가 판단하기가 어려워짐
	- 최신 IPS는 이런 형태의 공격을 방어하는 장치도 충분히 마련하고 있지만 여러 우회 공격을 섞기도 하고, 새로운 기법도 등장해 하나의 보안 장비로 다 막기에는 어려움이 있음

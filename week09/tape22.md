## 1. 보안의 개념과 정의

정보 보안은 크게 외부에서 시스템을 사용하지 못하게 보호하거나, 내부에서 유출 / 남용되는 것을 막기 위한 두 가지 분야로 구분된다.

보안의 정의는 조금씩 상이하나 3가지를 필수요소로 볼 수 있다.

- 기밀성 (confiendtiality)
    - 인가되지 않은 사용자가 정보를 보지 못하게 막는 작업
    - 암호화
- 무결성 (Integritiy)
    - 정확하고 완전하게 정보를 유지하는 것
    - SHA, MD5와 같은 hash 함수로 변경여부 확인
- 가용성 (Availability)
    - 정보가 필요할 때 접근을 허락하는 것

⇒ 즉, 인가된 사용자만 정확하고 완전한 정보를 필요할 때 접근할 수 있도록 하는 일련의 작업을 정보 보안으로 볼 수 있음.

**네트워크의 정보보안**

네트워크 입장에서는 수집된 정보를 침해하는 행동을 기술적으로 방어하거나, 정보 송수신 과정에서 생기는 사고를 방지하는 작업

- Trust 네트워크 / Untrust 네트워크
    - 외부로부터 보호받아야하는 네트워크
    - 신뢰할 수 없는 네트워크
- DMZ 네트워크 : 내부 네트워크지만 신뢰할 수 없는 외부 사용자에게 개방해야하는 경우
    - 인터넷에 공개되는 서비스

<img width="463" alt="Screenshot 2025-05-01 at 3 49 58 PM" src="https://github.com/user-attachments/assets/e90a80df-ba5b-48d5-a638-c2505f0eeba0" />


네트워크 보안 분야는 **트래픽 방향과 용도**에 따라 구분된다. 상황에 따라 요구되는 성능과 기능이 상이하기 때문이다.

- 인터넷 시큐어 게이트웨이
    - trust(DMZ) 네트워크 → untrust 네트워크로 통신을 통제
    - 수많은 인터넷 서비스가 있으므로 요청 패킷을 인식하고 필터링하는 기능으로, 내부 사용자가 인터넷으로 통신할 때 보안을 제공/통제하기 위해 사용
    - SWG, web filter, application control, 샌드박스 등
- 데이터 센터 시큐어 게이트웨이
    - untrust → trust(DMZ) 로의 통신을 통제
    - 외부의 직접적인 공격을 막아야하므로 성능과 공격 관련 정보가 중요
    - IPS, DCSG, WAF(web application firewall), Anti-DDos 등의 장비

**화이트리스트와 블랙리스트**

- 화이트리스트 : ip 와 통신정보 등이 있어서 방어에 문제가 없다고 명확히 판단되는 통신만 허용
- 블랙리스트 : 공격이라고 명확히 판단되거나 문제가 있는 ip, 패킷 리스트를 저장해서 방어
    - IPS, WAF 등은 기본적으로 블랙리스트 기반
    - 공격패턴 (signature) 을 db화해서 탐지

**정탐,오탐, 미탐(탐지 에러)**

- False positive(오탐), False negative(미탐)
    - 공격이라고 추론했는데 아닌 경우와
    - 공격이 아니라고 추론했는데 공격인 경우

** zero day attack : 공격 DB가 업데이트 되기 전 공격하는 현상

⇒ 네트워크 보안 장비는 외부/내부의 변화로 발전하고 있음

- 서비스나 인프라스트럭처의 변화로 보안이 발전해야하거나
- 해킹 기술의 발전에 대응하면서 새로운 보안 장비 및 서비스가 개발되어야하는 부분

---

## 2. 보안 솔루션의 종류

<img width="461" alt="Screenshot 2025-05-01 at 3 50 13 PM" src="https://github.com/user-attachments/assets/2bc2e710-9992-4b27-ac47-e7149a177cdd" />


데이터 센터에서는 보안 장비를 DDos - 방화벽 - IPS - WAF 형태로 디자인하여 여러 단계를 거쳐 공격을 막도록 배치한다.

**DDos 방어장비**

- 회선 사용량이나 트래픽을 과도하게 발생시켜 서비스 사용 자체를 방해는 볼류매트릭 공격을 막기 위해
- 데이터 센터 네트워크 내부/외부 경계에서 공격을방어하고, 완화시켜주어야함

**방화벽**

- 4계층에서 동작하는 패킷 필터링 장비
- 정책에 맞는 패킷이 방화벽을 통과하면 패킷을 allow/deny 할 수 있다.

**IPS, IDS**

- IDS (Instruction Detection System) 침입 탐지 시스템
- IPS (Intrusion Prevention System) 침임 방지 시스템

⇒ 애플리케이션 공격을 방어하는 장비를 IPS 로 통칭함.

사전에 공격 데이터베이스(Signature)을 제조사/ 위협 인텔리전스 서비스 업체로부터 받아서 모니터링을 진행한다.

- 애플리케이션을 골라서 방어할 수 있는 애플리케이션 컨트롤 기능이 추가되면서 화이트리스트 기반의 방어도 IPS에 적용됨

**WAF**

웹 서버를 보호하는 전용 보안 장비로, HTTP/HTTPS와 같이 웹 서버에서 동작하는 프로토콜 공격을 방어한다.

- IPS에서 방어할 수 없는 회피 공격을 방어함
    - IPS는 트래픽에서 공격 패턴으로 보이는 것을 감지하는 정도이지만
    - WAF는 http/https의 요청을 파싱해서 sql injection 같은 것이 있는지, 정상적인 호출인지를 판별할 수 있음.
- 프록시 서버와 같이 패킷을 데이터 형태로 조합해서 처리하기 때문
    - 방어 뿐 만 아니라 민감한 데이터가 유출될 때 해당 정보만 제거해서 내리거나 공격자에게 통보가 가능

**샌드박스**

악성코드를 PC에 우회적으로 심어서 관리자 PC를 컨트롤하는 방식으로 해킹이 진화 → APT, ATA로 발전

- APT 공격을 막는 대표적인 장비로, 악성 코드를 샌드박스 시스템 안에서 직접 실행하여 모니터링
- 파일들의 악성코드 여부를 판별하는 방법으로 감지

> APT : 이메일 등을 통해서 악성코드 / 보안 취약점을 발견해서 지속적으로 시스템 내부에서 공격을 하는 유형.
> 

**NAC**

Network Access Control로, 네트워크에 접속하는 장치를 제어

- 인가된 사용자만 내부망에 접속할 수 있는 기술
- 외부 PC가 내부망에 접속하는 것을 방지하기 위함


**IP 제어**

할당된 ip를 관리하고, 의도된 ip 할당이 아니면 네트워크를 사용하지 못하도록 관리하는 기능

**접근통제**

서버나 데이터베이스에 대한 direct access를 막고 작업을 추적 및 감사할 수 있는 솔루션

- 대부분 배스천 호스트 기반으로 구현
- 서버 호스트의 방화벽에 배스천 호스트에서 출발한 통신만 허용하는 방식으로 보안을 강화

**VPN**

- IPSEC 과 SSL (네트워크 연결용 / 사용자가 내부 네트워크에 연결 시)

---

## 3. 방화벽

네트워크 중간에 위치해 트래픽을 정책 조건에 맞추어 허용하거나 차단하는 장비

- 주로 3,4 계층에서 동작하며 세션을 인지하는 상태기반 엔진(SPI)으로 동작

**초기 방화벽**

패킷의 인과관계를 확인하지 못하고 장비에 등록된 정책만으로만 필터링을 진행했으며, 이를  stateless, packet filter라고 한다.

- 패킷이 장비에 인입되면
- 방화벽에 설정된 정책에 일치하는지 참고하는데
- 이런 조건을 5-tuple 이라고 한다.
    - source IP, destinaiton IP, protocol No, Source Port, Destination Port 5가지 주요 필드를 의미

다만 인터넷 환경에서 불특정 다수 기반의 정책을 정의하는 룰셋이 복잡해지고, 3,4계층 헤더를 변조해서 공격하면 방어가 어려운 단점이 있다.

다만 패킷 필터링 자체는 부하가 적고 간단하기 때문에, 현대의 일부 방화벽은 블랙리스트 처리를 위해  SPI 엔진과 함께 동작시키기도 한다.

**현대 방화벽 (SPI 엔진)**

이전 방화벽 방식의 한계는 

- 인터넷 환경에서 정책 관리가 힘들었으며
- 대부분 양방향으로 이루어지는 통신을 고려하지 못하고 단순한 패킷 조건만 일치하는지 확인했음
- 3 way handshake로 http 요청응답을 보낼 때 외부에서 내부로 들어오는 응답정책을 설정하기 어렵다.
    - 출발지 ip가 불특정해서 모든 포트를 다시 열어야하기 때문

그래서 패킷의 인과관계와 방향성을 인지해 정책을 적용하는 SPI 엔진이 등장했다.

- 내부 → 외부 인터넷 통신으로 받은 응답과
- 외부 → 내부로 직접 들어오는 패킷을 구분할 수 있게 됨.

**방화벽 동작방식**

제조사 별로 동작방식에는 차이가 있을 수 있으나 기본적인 플로우는 다음과 같다.

<img width="506" alt="Screenshot 2025-05-01 at 3 50 56 PM" src="https://github.com/user-attachments/assets/23dbbdc9-c27c-4318-878c-6a09c4f01af8" />


- 패킷이 들어오면 세션 상태 테이블부터 확인하고
    - 조건에 맞는 정보가 있으면 포워딩 테이블을 확인
    - 없으면 방화벽 정책을 확인
        - 방화벽 정책은
            - 맨 위 정책 → 최종 정책까지 확인하고 암시적 거부 규칙을 참고하여 차단한다.
            - 허용 규칙이 있으면 내용을 다시 세션 테이블에 적어둔다.
- 최종적으로 포워딩 테이블(ARP, 라우팅 포함)을 확인하고,
    - 조건에 맞는 정보가 있으면 적절한 인터페이스로 패킷을 포워딩
    - 없으면 패킷을 드롭

⇒ 세션 테이블은 패킷의 정보를 stateful하게 관리하기 위함이고, 포워딩 테이블은 실제로 정책이 확인된 패킷을 어디로 보내야하는지를 관리하는 테이블

SPI 엔진의 방화벽은 OSI 3,4 계층의 세부필드도 함께 확인하는데, 아래와 같은 변화를 감지하여 세션 탈취 공격을 일부 방어할 수 있다.

- TCP 컨트롤 플래그에 따라 동작 방식이 변하거나
- 시퀀스와 ack 번호가 변경되는 것을 인지

> 5 tuple 데이터
- 출발지 ip와 port, 도착지 ip와 port, 그리고 프로토콜 번호(3계층 프로토콜 지시자로 tcp, udp를 지정할 때 사용)
> 

**ALG**

FTP 와 같이 세션 방화벽 이전에 개발된 프로토콜은 방화벽이 중간에 있으면 통신이 불가능하다.

예를 들면 FTP는 client가 사용할 포트 정보를 서버에 보내면 서버가 응답하고, 클라이언트 데이터 포트에 서버가 접속하면 다시 클라이언트가 응답하는 구조이다. 

이런 active 모드에선

- 방화벽이 세션의 방향성을 알기가 어려움.
- **외부에서 port로 데이터 수신하겠다고 들어오는 셈이니까, 방화벽 입장에서는 임의의 port로 서버에 연결을 시도하는 셈이어서 보안정책에 다 적혀있지 않으면 차단된다.**
    - 또한 매번 클라이언트가 접속하려는 포트 번호가 달라지기 때문에 어떤 서버가 어떤 포트로 접속하려는지 알기도 어려움

그래서 이런 프로토콜을 통과시키기 위해 application 프로토콜을 확인하고 세션을 인지해 포트를 자동으로 열어주는 ALG 기능이 필요하다.

- FTP ALG 기능은 초기 FTP 요청 커맨드를 모니터링
- 서버 쪽에서 데이터 세션에 사용할 포트를 응답할 때, 세션 정보를 만들어둠

⇒ 하지만 이 또한 모든 프로토콜에 맞추어 개발될 수 없어 완벽한 해결책은 아니다.

- STUN과 같은 홀펀칭 기술도 발전해서 ALG는 사용하지 않는 추세

**한계**

DDos와 같은 서비스 중단 공격이나 백도어, 인터넷 웜을 방어할 수는 없음.

애플리케이션 프로토콜을 검사하지는 못하기 때문에 대응이 어렵다.

⇒ 그래서 이런 공격을 막기 위한 보안 장비가 IPS이며, 현대적인 방화벽으로는 NGFW, UTM가 있다.

⇒ 네트워크 컴포넌트를 가상화하여 하드웨어에 적용하는 기술은 NFV(Network Function Virtualization)이라고 부른다. 여러 공격을 방어하기 위해 네트워크 구조가 복잡해지는데, 이런 장비들을 하나로 묶어서 제공하거나 여러 장비가 유기적으로 동작하는 방향으로 발전하고 있다.

---

## 4. IPS, IDS

> 애플리케이션 계층에서 이루어지는 공격을 탐지/방어하기 위함
> 

<img width="462" alt="Screenshot 2025-05-01 at 3 51 13 PM" src="https://github.com/user-attachments/assets/8cf6c50a-9b16-4547-b5ea-fb5a75f855ec" />


**IPS(Intrusion Prevention System)**

- 공격이 발견되면 직접 차단하는 장비
- 트래픽이 지나가는 인라인 상에 장비를 배치해서 적극적으로 통신에 개입하여 유해 트래픽을 발라냄
- 일반적으로 IPS라 부르는 시스템은 네트워크 기반의 NIPS(Network Based IPS) 이다.

<img width="468" alt="Screenshot 2025-05-01 at 3 51 26 PM" src="https://github.com/user-attachments/assets/c805150c-4c9a-4344-8e9d-88b50930fdaf" />


**IDS(Intrusion Detection System)**

- 공격자가 시스템을 해킹하는 것을 **탐지**하기 위함
- 트래픽을 복제해 검토하고 침입 여부를 판별한다.

**동작방식**

기본적으로 signature(공격 데이터베이스)를 사용한 방식으로 운영되지만, 여러 다른 기법으로도 공격을 방어한다. 

1. 패턴 매칭 방식
    1. 공격 DB에서 최신 내용을 유지하면서 공격을 파악하는 패턴 방식
    2. 코드레드웜 같이 공격 스트링을 가진 요청으로 서버를 감염시키는 패턴을 IPS에서 갖고 있다가, 패킷이 들어오면 이 공격을 drop
2. 어노말리 공격 방어
    1. 패턴 매칭 방식과 같이 블랙리스트 기반의 방어로는 빠르게 변하는 알고리즘을 대응하기 어려워서 화이트리스트 기반의 방어 방법으로 대응
    2. **프로파일 어노말리**
        1. IPS나 관리자가 정의한 기준과 다른 행위가 일어나면 공격으로 간주
        2. DDos  방어 장비로 진화
    3. **프로토콜 어노말리**
        1. SPI 방화벽과 NAT 기능으로 PC를 공격하기 어렵게 만들자 웹 서버나 이메일에 악성코드를 심는 방법
        2. 감염된 내부 PC가 공격을 위한 통신을 할 때는 다른 프로토콜을 사용하는 경우가 흔하므로 이 차이를 파악해 젲어하는 기법

**NGIPS**

IPS, IDS의 한계와 극복

- flow 엔진은 패킷이 흘러가는 상황을 모니터링해서 탐지하기 때문에, 패킷을 데이터 형태로 모아서 검사하는 것은 아님
- 또한 오탐(false positive)도 많이 발생해서 초반 튜닝 작업이 필요하다.

NGPIS는 다양한 시스템과 연동하거나  APT 공격을 방지하기 위한 기능이 탑재되어있는 등 다양한 장비와 통합되는 추세이다.

** 허니팟 시스템: 공격 방어가 없고 취약한 시스템을 만들어서, 해커가 이런 곳을 공격하면 해당 내용을 로깅해 공격 기법을 분석하여 DB화 함

---

## 5. DDos 방어 장비

다수의 공격자를 만들어 동시에 Dos 공격을 하는 분산형 공격인 DDoS

<img width="464" alt="Screenshot 2025-05-01 at 3 51 48 PM" src="https://github.com/user-attachments/assets/77307033-9de3-489d-9d35-e4980811f839" />


- 볼류메트릭 공격을 방어하기 위해 트래픽 프로타일링 기법을 주로 사용하고, 공격 DB를 활용하기도 한다.

**동작방식**

클라우드 서비스, 회선 사업자의 방어 서비스, DDoS 방어 장비를 사내에 설치하는 방법 등이 있다. 탐지장비가 공격을 탐지해 ip 리스트를 넘기면 → 방어 장비나  IPS 내부에서 해당 ip를 드롭하는 것이 일반적인 방식이다.

- 평소의 데이터 흐름에 비해 대역폭, 세션량, 초기 접속량, 프로토콜 별 사용량 등을 저장하고 이 이상의 과도한 트래픽이 인입되면 알림을 주고 차단한다.

**DDoS 공격 타입**

1. 볼류메트릭 공격
    1. 트래픽을 과도하게 발생시켜 회선 사용량을 가득 채우는 공격
        1. 좀비 PC를 이용하거나 공격을 증폭하는 리플렉터에 패킷을 보내서 트래픽을 보내는 방법으로 공격한다.
    2. 예: NTP, DNS 증폭, TPC/UDP 플러드
    3. 장비 혼자서는 방어가 불가능하고, 회선을 공급하는 ISP 내부나 사용자 네트워크 최상단에서 공격을 완화해야함.
        1. 클라우드 기반의 DDos 방어서비스도 고려(서버 주소는 뒷단에 있고 클라우드에서 미리 요청을 받기 때문에 볼류메트릭 방어가 용이함)
2. 프로토콜 공격
    1. 3,4 계층의 취약점과 리소스 고갈을 노리는 공격
    2. 네트워크 장비나 보안 장비의 CPU, 메모리 자원을 고갈시켜서 서비스를 중단시킴
    3. 예: Syn 프러드, Ping of Death
3. 애플리케이션 공격
    1. 프로세스의 트랜잭션을 독점해 서버 자원을 소모한다.
    2. 예: HTTP 플러드, DNS 서비스 공격, Slowloris

---

## 6. VPN

Virtual Private Network는 공중망을 이용해 논리적으로 전용선을 직접 연결한 것처럼 망을 구성하는 기술. 이런 통로를 터널이라고 부르며, VPN을 이용하면 터널을 이용해 직접 연결한 것처럼 동작한다.

- VPN 은 인터넷 공용망을 이용하므로 암호화와 인증같은 보안 강화 기술을 적용해야함
    - 최근에는 **IPSEC**의 보안 기술이 추가적으로 함께 사용됨
- 본사-지사와 같은 네트워크 대 네트워크는 IPSEC VPN

<img width="467" alt="Screenshot 2025-05-01 at 3 52 00 PM" src="https://github.com/user-attachments/assets/a0161013-dc87-4958-9954-47b4e4c0e7f1" />


- 개인-본사 간에는 SSLVPN 기술이 사용
    - PC 대 네트워크이기 때문에 원격자는 별도의 네트워크 장비 없이 VPN 연결을 사용

<img width="463" alt="Screenshot 2025-05-01 at 3 52 09 PM" src="https://github.com/user-attachments/assets/6f6379e8-3128-4a8b-8ef2-75c07146f9c0" />


**동작방식**

- 패킷을 터널링 프로토콜로 감싸서 통신하는 터널링 기법을 사용
- 패킷을 암호화하거나, 인증/무결성 체크하는 보안 기능을 이용해 보안을 강화하여 데이터를 보호한다. (IPSEC, SSL)

VPN은 일반적으로 3가지 형태로 구현된다.

1. Host to Host  통신보호
    1. 두 호스트 간 직접 VPN으로 연동하는 기법이지만 잘 사용되진 않음
    2. vpn 터널로 인터넷 연결하여 사용
2. Network to Network 통신보호
    1. 본사 - 지사와 같이 특정 네트워크를 가진 두 종단을 연결하는 경우
    2. IPSEC
3. Host가 Network로 접근할 때 보호
    1. 모바일 사용자가 일반 인터넷 망을 통해 사내망으로 연결하는 경우
    2. IPSEC, SSL

---

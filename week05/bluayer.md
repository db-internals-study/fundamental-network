# Router

Router는 3계층 장비, 경로를 지정해주는. 패킷 목적지 IP 주소를 확인하고 자신이 가진 경로 정보를 이용해 패킷을 최적의 경로로 포워딩.

현대에는 라우터와 L3 스위치를 구분하기 어렵다.

## 라우터의 동작 방식과 역할

스위치와 반대로 라우터는 들어온 패킷의 목적지 주소가 라우팅 테이블에 없으면 패킷을 버림.

패킷 포워딩 과정에서 기존 2계층 헤더 정보를 제거하고 새로운 2계층 헤더를 만들어 냄

(경로 지정 -> 브로드 캐스트 컨트롤 -> 프로토콜 변환)

### 경로 지정

가장 중요한 역할. 경로 정보를 모아 라우팅 테이블을 만들고 패킷이 라우터로 들어오면 패킷의 도착지 IP 주소를 확인해 경로를 지정하고 포워딩.

정확한 목적지 경로를 얻는 것이 매우 중요함. 경로 학습 방법 -> 1/ IP 주소를 입력하며 자연스러운 인접 네트워크 정보 파악 2/ 라우터끼리 서로 경로 정보 자동 교환

### 브로드캐스트 컨트롤

기본 동작은 멀티 캐스트 정보를 습득하지 않고 브로드캐스트 패킷을 전달하지 않음.

네트워크에 브로드캐스트가 많이 발생하는 경우, 라우터로 네트워크를 분리하면 브로드캐스트 네트워크를 분할해 네트워크 성능을 높일 수 있음.

### 프로토콜 변환

서로 다른 프로토콜로 구성된 네트워크를 연결. (e.g. LAN to WAN)

## 경로 지정 - 라우팅/스위칭

다양하고 많은 경로 정보를 얻을 수 있지만 원하는 목적지 정보와 정확히 일치하지 않는 경우가 더 많음.

Summary 작업을 통해 여러 개의 서브넷 정보를 뭉쳐 전달하며, 라우팅 테이블 정보가 정확히 일치하지 않아도 근접 정보를 찾아 패킷을 포워딩 해야 함.

### 라우팅 동작과 라우팅 테이블 

인접한 라우터까지만 경로를 지정하면 인접 라우터에서 최적의 경로를 다시 파악 후 라우터로 패킷 포워딩 (Hop by hop)

- 다음 라우터의 IP 지정 : 일반적.
- 라우터의 나가는 인터페이스를 지정 : Next hop router ip를 모르지만 MAC 주소 정보를 알아낼 수 있을 때 (한정 조건)
- 라우터의 나가는 인터페이스와 다음 라우터의 IP를 동시 지정 : 일반적으로 물리 인터페이스 지정하지만, 이 경우 논리적인 인터페이스 사용 가능

라우팅 테이블에 저장하는 데이터
- 목적지 주소
- Next hop IP 주소, 나가는 로컬 인터페이스(선택 가능)

패킷 출발지 주소를 이용해 라우팅 하도록 PBR(Policy-Based Routing) 기능을 사용할 수 있으나, 별도 설정이 필요하고 다른 라우터로의 전파가 어려움. -> 특별 목적

***Source Routing과 PBR, Policy Routing***

PBR은 출발지 IP 만으로 경로 지정하는 것이 아니라 도착지 IP + 포트 번호와 같은 다양한 조건을 합쳐 사용

PBR과 소스 라우팅을 동의어로 쓰기도 하지만, 소스 라우팅은 라우터가 경로를 지정하는 것이 아니라 출발지에서 경로를 지정한다는 의미.

***Loop Free 3-tier : TTL***

대안 경로를 찾다가 루프를 도는 경우가 있는데, 유령 패킷이 넘칠 수 있기 때문에 TTL을 사용. TTL은 실제 초 시간이 아니고 Hop을 지칭하며, 하나의 Hop을 지날 때마다 TTL 값은 1씩 감소.

### 라우팅 (라우터가 경로 정보를 얻는 방법)

1. 다이렉트 커넥티드
2. 스테틱 라우팅
3. 다이나믹 라우팅

이를 통해 경로 정보를 수집하고 수집된 경로 정보 중 목적지에 대한 최적의 경로를 선정해 라우팅 테이블을 만듭니다.

#### 다이렉트 커넥티드(Direct Connected)

IP 주소가 속한 네트워크 주소 정보를 기반으로 라우팅 테이블을 만드는 방식

정보를 강제로 지울 수 없고 해당 네트워크 설정 삭제, 인터페이스 비활성시에만 사라짐

#### 스테틱 라우팅

관리자가 목적지 네트워크와 넥스트 홉을 라우터에 직접 지정.

논리 인터페이스는 물리 인터페이스가 비활성화되더라도 함께 사라지지 않는 경우가 있어 라우팅 테이블에서 사라지지 않을 수 있음.

#### 다이나믹 라우팅

스테틱 라우팅 : 네트워크 크기가 커지거나 라우터 너머의 다른 라우터 상태 정보 파악이 어려움 -> 장애 발생시 대체 경로 활용이 불가능

라우터끼리 자신이 알고 있는 경로 정보나 링크 상태 정보를 교환해 전체 네트워크 정보를 학습하고, 대체 경로 사용이 가능.

다이나믹 라우팅에서는 자신이 광고할 네트워크를 선언해줘야 함.

다양한 경로 정보를 데이터베이스화하고 순위를 적절히 부여해 최선의 경로 정보를 수집 (원시 데이터 : 토폴로지 테이블, 최적의 경로 : 라우팅 테이블)

**중요한 것은** 다음 라우터까지만 패킷을 포워딩.

### 스위칭

# 서버 네트워크 기본

서버 쪽에서 네트워크를 이해하면 네트워크 상태를 판단할 수 있고, 네트워크 쪽에서 서비스에 대한 이해가 깊으면 문제 해결이 훨씬 쉽다.

## 서버의 네트어크 설정 및 확인

일반적으로 DHCP로 네트워크 정보 설정

### 리눅스 서버 네트워크

인터페이스 설정 파일 수정 후 네트워크 서비스 or 인터페이스 재시작

ifconfig를 사용해서 인터페이스를 확인하거나 ip address 같은 방법으로 확인 가능. ip -s link 하면 인퍼테이스로 송수신되는 패킷 정보도 나옴

## 서버의 라우팅 테이블

서버에서의 라우팅 테이블 항목 : 목적지 서브넷 게이트웨이 인터페이스 우선순위(메트릭)

netstat -r 같은 걸로 확인할 수 있음. 단, metric 같은 특정 값은 ip route에서만 확인 가능하기 때문에 적절한 도구를 사용해야 함.

더 적은 메트릭 -> 높은 우선순위(액티브) / 더 높은 메트릭 -> 스탠바이

액티브 경로에 문제가 발생하면 라우팅 테이블에서 해당 경로가 삭제되고 스탠바이로 통신이 fail-over됨.

route add, del로 수정할 수 있지만 재부팅하면 사라지기 때문에 필요시 파일로 영구적인 라우팅 설정을 함.

## 네트워크 확인을 위한 명령어

### ping

ping -> ICMP / 확장 ping -> 옵션과 함께 사용. 출발지 IP 설정도 가능

### traceroute

traceroute : 출발지부터 목적지까지의 네트워크 경로 확인. IP 헤더의 TTL 정보를 이용해 확인하며 2계층 이하의 장비 추적은 불가능.

보안상 이유로 차단되는 경우 `***`로 표기됨

윈도 계열은 ICMP 기반, 리눅스/유닉스 계열은 UDP 기반으로 동작(TCP 옵션 있음)

### netstat

일반적으로 서비스 포트 상태를 확인하는 용도로 사용됨. netstat 대신 ss, ip 등 다양하게 대체 가능

### ss(socket statistics)

소켓 정보를 확인할 수 있음. netstat 대체 가능하고 더 많은 정보를 추가로 확인할 수 있음. 커널 스페이스를 통해 직접 가져오기 때문에 netstat보다 빠름.

상태값으로 필터링할 수 있음

### nslookup(name server lookup)

외부 DNS로 잘 전파되었는지 확인할 때 사용

### telnet

원격지 호스트에 터미널 연결을 위해 사용. 접근 가능성 테스트 용도로도 사용 가능. 단, telnet은 평문을 사용하기 때문에 보안 위험.

1. 네트워크 경로 문제 : ping or traceroute로 대략적인 문제 파악 가능
2. 보안 장비에 의해 차단된 경우 : 다른 포트나 ICMP 이용하는 ping or traceroute로 일부 파악 가능
3. 단말의 방화벽 기능을 일시적으로 내리고 테스트 수행해서 문제 파악
4. netstat과 ss를 이용해서 서비스가 정상 동작하고 있는지, 어떤 프로세스와 포트가 연동되는지 파악해서 문제 해결

### ipconfig

DHCP로 받은 IP 주소를 해제하고 갱신하는 것이 가능. 혹은 도메인 로컬 캐시 정보를 지우기 위해서 사용할 수도 있음.(flushdns)

***APIPA(Automatic Private IP Addressing)***

호스트 컴퓨터 스스로 IP 주소를 자동 할당. DHCP가 네트워크에 없거나 정상 동작 안할 때 IP 주소를 자동 할당해 통신이 가능하도록 함. 169.254.0.0/16을 할당

### tcpdump

패킷을 캡쳐해보는 기능의 명령어. 보통 전체 인터페이스가 아닌 특정 인터페이스의 패킷만 필터링하고, IP 주소 포트 등으로 필터링

```bash
# 172.16.10.10이 출발지 또는 목적지면서 HTTP 서비스 패킷 캡쳐
tcpdump -i eth0 tcp port 80 and host 172.16.10.10

# tcpdump 결과를 dumpfile.pcap 파일로 출력
tcmpdump -i eth0 -w dumpfile.pcap
```

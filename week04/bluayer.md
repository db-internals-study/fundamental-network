# 스위치

MAC 주소를 기반으로 패킷을 전달하는 동작 수행 +  한 대의 장비에서 논리적으로 네트워크를 분리할 수 있는 VLAN + 네트워크 루프를 방지하는 스패닝 트리 프로토콜(STP)

그리고 보안, 모니터링도 가능

## 4.1 스위치 장비 동작

패킷을 동시에 여러 장비가 서로 간섭 없이 통신하도록 도와주는 장비 : 스위치

여러 단말이 한꺼번에 통신 가능 -> 통신하기 위해 기다리거나 충돌 때문에 대기하는 문제가 해결

누가 어느 위치에 잇는지 파악하고 실제 통신 시 자신이 알고 있는 위치로 패킷을 정확히 전달 ->  단말 주소인 MAC 주소와 단말이 위치하는 인터페이스 정보를 매핑한  **MAC 주소 테이블**을 갖고 있어서 가능

아무튼 동작 방식이 총 3가지임

1. 플러딩(Flooding)
2. 어드레스 러닝(Address Learning)
3. 포워딩/필터링(Forwarding/Filtering)

### 플러딩

스위치가 허브와 같이 모든 포트로 패킷을 흘리는 동작 방식 : 플러딩

당연히 플러딩이 많아지면 정상적인 동작이 불가능함

***비정상적인 플러딩***

이더넷-TCP/IP 네트워크에서는 ARP 브로드캐스트를 주고받은 후 데이터가 전달되므로 실제로 데이터를 보내고 받을 때는 스위치가 패킷을 플러딩하지 않음.

스위치 기능을 무력화하는 공격 기법 : 엉뚱한 MAC 주소를 습득시키거나 MAC 테이블을 꽉 차게함.

ARP 포이즈닝을 통해 모니터링해야 할 IP의 MAC 주소가 공격자 자신인 것처럼 속이기도 함.

### 어드레스 러닝

MAC 주소 테이블을 만들고 유지하는 과정을 어드레스 러닝이라고 함.

패킷이 특정 포트에 들어오면 패킷의 출발지 MAC 주소와 포트번호를 MAC 주소 테이블에 기록함. (브로드캐스트, 멀티캐스트에 대한 MAC 주소를 학습할 수 없음 -> 목적지 MAC 주소 필드에서만 사용하기 때문)

***사전 정의된 MAC 주소 테이블***

스위치 간 통신을 위해  사전에 미리 정의된 MAC 주소 정보를 가지고 있음

### 포워딩/필터링

도착지 MAC 주소를 확인하고 자신이 가진 MAC 테이블과 비교해 맞는 정보가 있으면 해당 포트로 패킷을 **포워딩**하고

다른 포트로는 해당 패킷을 보내지 않으므로 **필터링**하게 됨

일반적인 유니캐스트에 대해서만 포워딩과 필터링 작업을 하게 됨. BUM 트래픽은 플러딩

***LAN에서의 ARP***

이더넷-TCP/IP 네트워크에서는 스위치가 유니캐스트를 플러딩하는 경우가 거의 없음 -> ARP를 먼저하기 때문. 이 과정에서 스위치는 출발/목적지 MAC 주소를 습득

ARP, MAC 테이블은 일정 시간동안 지워지지 않으며 Aging Time이라고 함. (MAC Table aging > ARP aging -> No flooding!)

## VLAN

하나의 물리 스위치에서 여러 개의 네트워크를 나누어 사용할 수 있게 함

VLAN 간의 통신이 필요하다면 서로 다른 네트워크 간의 통신이므로 3계층 장비가 필요

VLAN을 통해 논리적, 서비스/단말의 성격에 따라 네트워크를 분리하거나 물리적으로 다른 층에 있는 단말을 동일한 네트워크로 묶을 수도 있음.

### VLAN의 종류와 특징

포트 기반 VLAN : 스위치를 논리적으로 분할해 사용, 일반적인 VLAN. VLAN 선정 기준은 스위치의 포트 (앞으로 다룰 VLAN)

MAC 기반 VLAN : 스위치에 연결되는 단말의 MAC을 기반으로 VLAN을 할당 (Dynamic VLAN)

### VLAN 모드(Trunk/Access) 동작 방식

같은 스위치에 연결되더라도 서로 다른 VLAN이 설정된 포트 간에는 통신할 수 없음. (분리된 스위치에 연결된 것과 동일하기 때문)

이 경우 3계층 장비를 이용해야 함.

여러 개의 VLAN이 존재할 때, 스위치를 서로 연결해야 한다면 VLAN 개수만큼 포트를 연결해야 함 -> 포트 낭비가 발생할 수 있음

그래서 VLAN 태그 기능을 통해 하나의 포트에 여러 개의 VLAN을 함께 전송할 수 있게 함 (Tagged 포트 or Trunk 포트)

이더넷 프레임 중간에 VLAN ID 필드를 끼워 넣어 이 정보를 이용

***알반적 용어는 "태그 포트"지만 시스코에서는 "트렁크 포트"라고 부르며, 타 제조사에서는 다른 의미로 사용하기 때문에 주의 필요. 일반 포트는 Untagged, Access 포트라고 부름***

MAC 테이블에도 VLAN 지정 필드가 생겨서, VLAN 별로 MAC 주소 테이블이 존재하는 것처럼 동작

스위치 간 연결 외에도 서버와 연결된 포트도 VMWare, ESXi 같은 가상화 서버와 연결된다면 태그 포트로 설정해야 함. (가상화 서버 내에 가상화 스위치가 있기 때문)

### STP




